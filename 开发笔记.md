# 开发笔记

## 版本：2025.12.15

### 1 程序文件视图

```json
excerpts_tool/(项目包)
├── main.py(程序主入口)
├── version.py(版本信息)
└── data/(摘录数据库)
    ├── excerpts1.db
    └── ......
└── excerpts/(摘录数据库)
    └── htmlgui/(html创建的gui)
        ├── __init__.py
        └── static/(hitml的静态文件，目前只有js和css)
            └── css/
                ├── app.css
                └── selectdb.css
            └── js/
                └── app.js
        └── templates/(hitml静态文件)
            ├── app.html
            └── selectdb.html
        └── views/(视图文件静态文件)
            ├── __init__.py
            ├── api_view.py(摘录相关查询和操作的api，在js调用)
            ├── config_view.py(选择文件视图)
            └── app_view.py(摘录界面视图)
        └── config.py(简单配置)
    └── qtgui/(pyside6 gui)
        ├── __init__.py
        ├── cards.py(cards、tags)
        ├── mainwindow.py(主要界面)
        └── panels.py(不同区域的ui)
    └── sqlutils/(摘录数据库管理器)
        ├── __init__.py
        ├── datatool.py(摘录数据库管理器)
        └── sqlbase.py(对sqlite的封装)
    ├── __init__.py
    ├── htmlrun.py(启动html)
    └── qtrun.py(启动qt)
├── add_test.py(批量创建摘录工具)
├── parse_quotes_file_tool.py(格式化文本段落工具)
├── requirements.txt(所需库)
├── LICENSE
├── README.md
└── 开发笔记.md
```

### 2 摘录数据库管理器

#### 2.1 TableHelper

封装了SQLite3的游标。用于IdTableHelper、DataExcerptTags、DataTags、DataExcerpts等继承。

#### 2.2 IdTableHelper

封装了SQLite3的游标，改对象有一个唯一的ID字段，用于唯一标识记录。用于DataTags、DataExcerpts等继承。

#### 2.3 SqlbaseHelper

对SQLite3进行简单封装。用于SqlDataManager继承。

支持创建指定键的单例，默认创建到键为0的位置。

#### 2.4 TagData、TagDataDict

tag的数据类（字典）。

#### 2.5 ExcerptData、ExcerptDataDict

excerpt的数据类（字典）。

#### 2.6 DataExcerptTags

tag和excerpt的cid关联表。

#### 2.7 DataTags

tag数据表。

#### 2.8 DataExcerpts

excerpt数据表。

#### 2.9 SqlDataManager

各个表的数据管理库。

### 3 qtgui

#### 3.1 基本组件

- CardWidget：摘录卡片，用于摘录窗口和放大摘录的面板
- DataTagWidget：标签卡，用于标签栏和标签管理窗口
- DataTagItem：DataTagWidget所在的容器，使其有选项卡相关操作

#### 3.2 相关对话框

- ExcerptDataDialog：新建或修改摘录卡片
- TagManagerDialog：管理标签
- DataManagerDialog：数据库文件管理
- SqlReaderDialog：数据库文件选择和加载

#### 3.3 主要面板

- TagList：标签选项组
- SearchBar：搜索框
- SideBar：标签侧边栏
- Topbar：摘录顶部组件
- ColumnsArea：瀑布流单列
- MasonryArea：瀑布流
- ContentPanel：摘录面板
- MainUI：主程序

### 4 htmlgui

使用flask创建，html界面仿照qtgui。

flask实现3个Blueprint，第一个文件选择，第二个工具界面，第三个相关api。



## 更新计划

1、更改cards显示，日期新的显示在顶部

2、增加切换column数量的按钮，默认为3列，可以手动修改列数。未修改列时，不进行全部重排

3、更新tag时，只刷新相关的crads。

4、card默认渲染为图片。

5、card鼠标悬停动画。


